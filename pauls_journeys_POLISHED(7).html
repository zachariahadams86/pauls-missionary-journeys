<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paul's Missionary Journeys - Interactive Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; }
        
        .container { display: flex; height: 100vh; }
        
        .sidebar {
            width: 380px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-content {
            padding: 20px;
            flex: 1;
        }
        
        .main-content { flex: 1; position: relative; }
        #map { width: 100%; height: 100%; }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 1.8em; margin-bottom: 8px; }
        .header p { opacity: 0.9; font-size: 0.95em; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .stat-value { font-size: 2em; font-weight: bold; line-height: 1; }
        .stat-label { font-size: 0.85em; opacity: 0.9; margin-top: 4px; }
        
        .section {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }
        
        .section-title {
            font-size: 0.9em;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            margin-bottom: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn:hover { 
            background: rgba(255,255,255,0.2); 
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-1px);
        }
        
        .btn.active { 
            background: white; 
            color: #667eea; 
            border-color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn-icon {
            font-size: 1.2em;
            width: 24px;
            text-align: center;
        }
        
        .step-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .step-nav .btn {
            flex: 1;
            justify-content: center;
            padding: 12px;
        }
        
        .step-info {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            text-align: center;
            font-size: 0.95em;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .tab-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
        }
        
        .tab-btn.active { 
            background: white; 
            color: #667eea;
            border-color: white;
        }
        
        .tab-icon { font-size: 1.4em; }
        .tab-label { font-size: 0.85em; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .scripture-btn {
            width: 100%;
            padding: 14px;
            margin-bottom: 8px;
            border: none;
            background: rgba(255,255,255,0.15);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            font-size: 0.95em;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .scripture-btn:hover { 
            background: rgba(255,255,255,0.25); 
            transform: translateX(4px);
        }
        
        .scripture-btn.active { 
            background: white; 
            color: #667eea;
            font-weight: 600;
        }
        
        .scripture-text {
            background: white;
            color: #2c3e50;
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            line-height: 1.8;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .scripture-text.active { display: block; }
        
        .quiz-intro, .quiz-question { 
            background: rgba(255,255,255,0.1); 
            padding: 25px; 
            border-radius: 12px; 
        }
        
        .quiz-question { display: none; }
        
        .quiz-intro h3 {
            font-size: 1.5em;
            margin-bottom: 12px;
        }
        
        .quiz-intro p {
            margin: 12px 0;
            line-height: 1.6;
            opacity: 0.95;
        }
        
        .quiz-answer {
            padding: 16px;
            margin-bottom: 10px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.15);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
            font-size: 1em;
            position: relative;
            padding-left: 48px;
        }
        
        .quiz-answer::before {
            content: attr(data-letter);
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .quiz-answer:hover:not(:disabled) { 
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
            transform: translateX(4px);
        }
        
        .quiz-answer:disabled { 
            cursor: not-allowed;
        }
        
        .quiz-answer.correct {
            background: rgba(46, 213, 115, 0.3);
            border-color: #2ecc71;
        }
        
        .quiz-answer.incorrect {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
        }
        
        .feedback {
            margin-top: 15px;
            padding: 18px;
            background: white;
            color: #2c3e50;
            border-radius: 10px;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .feedback.active { display: block; }
        
        .feedback-status {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-width: 220px;
        }
        
        .legend-title { 
            font-weight: bold; 
            margin-bottom: 12px; 
            color: #2c3e50;
            font-size: 1.05em;
        }
        
        .legend-item { 
            display: flex; 
            align-items: center; 
            margin: 8px 0; 
            font-size: 0.9em;
            color: #2c3e50;
        }
        
        .legend-color { 
            width: 16px; 
            height: 16px; 
            border-radius: 50%; 
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .footer { 
            text-align: center; 
            padding: 15px 20px;
            font-size: 0.85em; 
            opacity: 0.8;
            background: rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-content">
                <div class="header">
                    <h1>üó∫Ô∏è Paul's Journeys</h1>
                    <p>Acts 13-21 (AD 46-58)</p>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-locations">43</div>
                        <div class="stat-label">Locations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Journeys</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">6</div>
                        <div class="stat-label">Epistles</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Years</div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">Journey Navigation</div>
                    <button class="btn active" onclick="showJourney('all')">
                        <span class="btn-icon">üåç</span>
                        <span>View All Journeys</span>
                    </button>
                    <button class="btn" onclick="showJourney(1)">
                        <span class="btn-icon">1Ô∏è‚É£</span>
                        <span>First Journey (AD 46-48)</span>
                    </button>
                    <button class="btn" onclick="showJourney(2)">
                        <span class="btn-icon">2Ô∏è‚É£</span>
                        <span>Second Journey (AD 49-52)</span>
                    </button>
                    <button class="btn" onclick="showJourney(3)">
                        <span class="btn-icon">3Ô∏è‚É£</span>
                        <span>Third Journey (AD 53-58)</span>
                    </button>
                </div>
                
                <div class="section">
                    <div class="section-title">Step Through Journey</div>
                    <div class="step-info" id="step-info">Select a journey to navigate step-by-step</div>
                    <div class="step-nav">
                        <button class="btn" onclick="prevStep()" id="prev-btn" disabled>
                            <span>‚Üê Previous</span>
                        </button>
                        <button class="btn" onclick="nextStep()" id="next-btn" disabled>
                            <span>Next ‚Üí</span>
                        </button>
                    </div>
                    <button class="btn" onclick="resetSteps()" id="reset-btn" style="display:none;">
                        <span class="btn-icon">üîÑ</span>
                        <span>Reset to Start</span>
                    </button>
                </div>
                
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('journey')">
                        <span class="tab-icon">üìç</span>
                        <span class="tab-label">Map</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('scripture')">
                        <span class="tab-icon">üìñ</span>
                        <span class="tab-label">Scripture</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('quiz')">
                        <span class="tab-icon">üéØ</span>
                        <span class="tab-label">Quiz</span>
                    </button>
                </div>
                
                <div id="journey-tab" class="tab-content active">
                    <div style="background: rgba(255,255,255,0.15); padding: 18px; border-radius: 10px; line-height: 1.6;">
                        <p style="margin-bottom: 10px;">üí° <strong>How to Use:</strong></p>
                        <p style="font-size: 0.9em; opacity: 0.95;">
                            ‚Ä¢ Click markers on the map for details<br>
                            ‚Ä¢ Select a specific journey above<br>
                            ‚Ä¢ Use Previous/Next buttons to walk through step-by-step
                        </p>
                    </div>
                </div>
                
                <div id="scripture-tab" class="tab-content">
                    <button class="scripture-btn" onclick="showScripture(0)">üìú Acts 13 - First Journey Begins</button>
                    <button class="scripture-btn" onclick="showScripture(1)">üìú Acts 14 - Stoned at Lystra</button>
                    <button class="scripture-btn" onclick="showScripture(2)">üìú Acts 15 - Jerusalem Council</button>
                    <button class="scripture-btn" onclick="showScripture(3)">üìú Acts 16 - Macedonian Vision</button>
                    <button class="scripture-btn" onclick="showScripture(4)">üìú Acts 17 - Mars Hill Sermon</button>
                    <button class="scripture-btn" onclick="showScripture(5)">üìú Acts 18 - 18 Months in Corinth</button>
                    <button class="scripture-btn" onclick="showScripture(6)">üìú Acts 19 - 3 Years in Ephesus</button>
                    <button class="scripture-btn" onclick="showScripture(7)">üìú Acts 20 - Eutychus Raised</button>
                    <button class="scripture-btn" onclick="showScripture(8)">üìú Acts 21 - Arrested in Jerusalem</button>
                    <div id="scripture-texts"></div>
                </div>
                
                <div id="quiz-tab" class="tab-content">
                    <div class="quiz-intro">
                        <h3>üìö Test Your Knowledge</h3>
                        <p>Ready to test what you've learned about Paul's missionary journeys?</p>
                        <p>This quiz covers all three journeys with 20 questions about locations, miracles, epistles, and key events from Acts 13-21.</p>
                        <button class="btn" onclick="startQuiz()" style="margin-top: 15px;">
                            <span class="btn-icon">üöÄ</span>
                            <span>Start Quiz</span>
                        </button>
                    </div>
                    <div class="quiz-question">
                        <div style="margin-bottom: 12px; opacity: 0.9; font-size: 0.9em;">
                            Question <span id="q-num">1</span> of 20
                        </div>
                        <div id="q-text" style="font-size: 1.15em; margin-bottom: 20px; font-weight: 600;"></div>
                        <div id="q-answers"></div>
                        <div id="q-feedback" class="feedback"></div>
                        <button class="btn" style="display: none; margin-top: 15px;" id="next-btn-quiz" onclick="nextQuestion()">
                            <span class="btn-icon">‚Üí</span>
                            <span>Next Question</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Created by Zachariah Adams ¬© 2024
            </div>
        </div>
        
        <div class="main-content">
            <div id="map"></div>
            <div class="legend">
                <div class="legend-title">Journey Legend</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3498db;"></div>
                    First Journey (46-48)
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c;"></div>
                    Second Journey (49-52)
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2ecc71;"></div>
                    Third Journey (53-58)
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9b59b6;"></div>
                    Epistle Written Here
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log("Loading Paul's Journey Map...");
        
        // Continuing in next file part...
        
        // JOURNEY DATA - same as before
        const journeyData = [
            {j:1, name:"Antioch, Syria", lat:36.2, lng:36.17, year:46, title:"Journey Begins", desc:"Sent out by the Holy Spirit", ref:"Acts 13:1-3", scripture:"Now in the church at Antioch there were prophets and teachers... While they were worshiping the Lord and fasting, the Holy Spirit said, 'Set apart for me Barnabas and Saul for the work to which I have called them.' Then after fasting and praying they laid their hands on them and sent them off."},
            {j:1, name:"Seleucia", lat:36.14, lng:35.91, year:46, title:"Port", desc:"Depart for Cyprus", ref:"Acts 13:4", scripture:"So, being sent out by the Holy Spirit, they went down to Seleucia, and from there they sailed to Cyprus."},
            {j:1, name:"Salamis, Cyprus", lat:35.19, lng:33.90, year:46, title:"Preaching", desc:"Preach in synagogues", ref:"Acts 13:4-5", scripture:"When they arrived at Salamis, they proclaimed the word of God in the synagogues of the Jews. And they had John to assist them."},
            {j:1, name:"Paphos, Cyprus", lat:34.76, lng:32.42, year:47, title:"Elymas Blind", desc:"Paul strikes Elymas blind, Proconsul believes", ref:"Acts 13:6-12", scripture:"But Elymas the magician opposed them, seeking to turn the proconsul away from the faith. But Saul, who was also called Paul, filled with the Holy Spirit, looked intently at him and said, 'You son of the devil... the hand of the Lord is upon you, and you will be blind.' Immediately mist and darkness fell upon him... Then the proconsul believed, when he saw what had occurred, for he was astonished at the teaching of the Lord."},
            {j:1, name:"Perga", lat:36.96, lng:30.85, year:47, title:"Mark Leaves", desc:"John Mark departs", ref:"Acts 13:13", scripture:"Now Paul and his companions set sail from Paphos and came to Perga in Pamphylia. And John left them and returned to Jerusalem."},
            {j:1, name:"Antioch in Pisidia", lat:38.31, lng:31.18, year:47, title:"Paul's Sermon", desc:"Famous sermon, then persecution", ref:"Acts 13:14-52", scripture:"But they went on from Perga and came to Antioch in Pisidia... Paul stood up and said: 'Men of Israel and you who fear God, listen... Let it be known to you therefore, brothers, that through this man forgiveness of sins is proclaimed to you.' ...But the Jews incited the devout women of high standing and the leading men of the city, stirred up persecution against Paul and Barnabas, and drove them out of their district."},
            {j:1, name:"Iconium", lat:37.87, lng:32.48, year:47, title:"Believes & Persecution", desc:"Many believe, opposition arises", ref:"Acts 14:1-7", scripture:"Now at Iconium they entered together into the Jewish synagogue and spoke in such a way that a great number of both Jews and Greeks believed. But the unbelieving Jews stirred up the Gentiles and poisoned their minds... So they remained for a long time, speaking boldly for the Lord, who bore witness to the word of his grace, granting signs and wonders to be done by their hands."},
            {j:1, name:"Lystra", lat:37.64, lng:32.43, year:47, title:"Healed & Stoned", desc:"Cripple healed, Paul stoned and left for dead", ref:"Acts 14:8-20", scripture:"Now at Lystra there was a man sitting who could not use his feet... Paul said in a loud voice, 'Stand upright on your feet.' And he sprang up and began walking... But Jews came from Antioch and Iconium, and having persuaded the crowds, they stoned Paul and dragged him out of the city, supposing that he was dead. But when the disciples gathered about him, he rose up and entered the city."},
            {j:1, name:"Derbe", lat:37.35, lng:33.20, year:47, title:"Many Disciples", desc:"Make many disciples", ref:"Acts 14:20-21", scripture:"On the following day he went on with Barnabas to Derbe. When they had preached the gospel to that city and had made many disciples, they returned to Lystra and to Iconium and to Antioch."},
            {j:1, name:"Lystra (return)", lat:37.64, lng:32.43, year:48, title:"Strengthening", desc:"Return strengthening disciples", ref:"Acts 14:21-23", scripture:"They returned to Lystra and to Iconium and to Antioch, strengthening the souls of the disciples, encouraging them to continue in the faith, and saying that through many tribulations we must enter the kingdom of God."},
            {j:1, name:"Iconium (return)", lat:37.87, lng:32.48, year:48, title:"Strengthening", desc:"Appointing elders", ref:"Acts 14:21-23", scripture:"And when they had appointed elders for them in every church, with prayer and fasting they committed them to the Lord in whom they had believed."},
            {j:1, name:"Antioch in Pisidia (return)", lat:38.31, lng:31.18, year:48, title:"Elders", desc:"Commending to the Lord", ref:"Acts 14:21-23", scripture:"Then they passed through Pisidia and came to Pamphylia, strengthening the churches and appointing elders in every place."},
            {j:1, name:"Perga (return)", lat:36.96, lng:30.85, year:48, title:"Preaching", desc:"Preach the word", ref:"Acts 14:25", scripture:"And when they had spoken the word in Perga, they went down to Attalia."},
            {j:1, name:"Attalia", lat:36.88, lng:30.70, year:48, title:"Sail Home", desc:"Port for return", ref:"Acts 14:25", scripture:"And from Attalia they sailed to Antioch, where they had been commended to the grace of God for the work that they had fulfilled."},
            {j:1, name:"Antioch (return)", lat:36.2, lng:36.17, year:48, title:"Journey Complete", desc:"Report to church", ref:"Acts 14:26-28", epistle:"Galatians (AD 48-49)", scripture:"And when they arrived and gathered the church together, they declared all that God had done with them, and how he had opened a door of faith to the Gentiles. And they remained no little time with the disciples."},
            {j:2, name:"Jerusalem Council", lat:31.77, lng:35.21, year:49, title:"Council", desc:"Gentiles don't need circumcision", ref:"Acts 15:4-29", scripture:"When they came to Jerusalem, they were welcomed by the church... Then the apostles and the elders, with the whole church, decided... 'It has seemed good to the Holy Spirit and to us to lay on you no greater burden than these requirements: that you abstain from what has been sacrificed to idols, and from blood, and from what has been strangled, and from sexual immorality.'"},
            {j:2, name:"Antioch", lat:36.2, lng:36.17, year:49, title:"Split", desc:"Paul takes Silas, Barnabas takes Mark", ref:"Acts 15:30-41", scripture:"So when they were sent off, they went down to Antioch, and having gathered the congregation together, they delivered the letter. And when they had read it, they rejoiced... But Paul and Barnabas remained in Antioch... And after some days Paul said to Barnabas, 'Let us return and visit the brothers'... And there arose a sharp disagreement, so that they separated from each other. Barnabas took Mark with him and sailed away to Cyprus, but Paul chose Silas."},
            {j:2, name:"Syria & Cilicia", lat:36.5, lng:36.0, year:49, title:"Strengthening", desc:"Strengthen churches", ref:"Acts 15:40-41", scripture:"But Paul chose Silas and departed, having been commended by the brothers to the grace of the Lord. And he went through Syria and Cilicia, strengthening the churches."},
            {j:2, name:"Derbe", lat:37.35, lng:33.20, year:49, title:"Revisit", desc:"Revisiting churches", ref:"Acts 16:1", scripture:"Paul came also to Derbe and to Lystra."},
            {j:2, name:"Lystra", lat:37.64, lng:32.43, year:49, title:"Timothy Joins", desc:"Timothy joins the team", ref:"Acts 16:1-5", scripture:"A disciple was there, named Timothy, the son of a Jewish woman who was a believer, but his father was a Greek. He was well spoken of by the brothers at Lystra and Iconium. Paul wanted Timothy to accompany him, and he took him and circumcised him because of the Jews who were in those places."},
            {j:2, name:"Iconium", lat:37.87, lng:32.48, year:49, title:"Decrees", desc:"Delivering Council decrees", ref:"Acts 16:2-4", scripture:"As they went on their way through the cities, they delivered to them for observance the decisions that had been reached by the apostles and elders who were in Jerusalem. So the churches were strengthened in the faith, and they increased in numbers daily."},
            {j:2, name:"Phrygia & Galatia", lat:38.5, lng:30.0, year:50, title:"Forbidden", desc:"Forbidden to preach in Asia", ref:"Acts 16:6", scripture:"And they went through the region of Phrygia and Galatia, having been forbidden by the Holy Spirit to speak the word in Asia."},
            {j:2, name:"Troas", lat:39.78, lng:26.06, year:50, title:"Vision", desc:"Macedonian vision: 'Come help us'", ref:"Acts 16:8-10", scripture:"So, passing by Mysia, they went down to Troas. And a vision appeared to Paul in the night: a man of Macedonia was standing there, urging him and saying, 'Come over to Macedonia and help us.' And when Paul had seen the vision, immediately we sought to go on into Macedonia, concluding that God had called us to preach the gospel to them."},
            {j:2, name:"Philippi", lat:41.01, lng:24.29, year:50, title:"Earthquake", desc:"Lydia, demon cast out, earthquake, jailer saved", ref:"Acts 16:12-40", scripture:"A certain woman named Lydia, from the city of Thyatira, a seller of purple goods, who was a worshiper of God, heard us... The Lord opened her heart... As we were going to the place of prayer, we were met by a slave girl who had a spirit of divination... Paul said to the spirit, 'I command you in the name of Jesus Christ to come out of her.' And it came out that very hour... About midnight Paul and Silas were praying and singing hymns... and suddenly there was a great earthquake... And the jailer called for lights and rushed in... 'Sirs, what must I do to be saved?' And they said, 'Believe in the Lord Jesus, and you will be saved.'"},
            {j:2, name:"Amphipolis", lat:40.82, lng:23.85, year:50, title:"Passing", desc:"Passing through", ref:"Acts 17:1", scripture:"Now when they had passed through Amphipolis and Apollonia, they came to Thessalonica."},
            {j:2, name:"Apollonia", lat:40.73, lng:23.31, year:50, title:"Passing", desc:"Passing through", ref:"Acts 17:1", scripture:"Now when they had passed through Amphipolis and Apollonia, they came to Thessalonica."},
            {j:2, name:"Thessalonica", lat:40.64, lng:22.94, year:50, title:"Jason Attacked", desc:"Mob attacks Jason's house", ref:"Acts 17:1-9", scripture:"Now when they had passed through Amphipolis and Apollonia, they came to Thessalonica, where there was a synagogue of the Jews. And Paul went in, as was his custom, and on three Sabbath days he reasoned with them from the Scriptures... But the Jews were jealous, and taking some wicked men of the rabble, they formed a mob, set the city in an uproar, and attacked the house of Jason... And they dragged Jason and some of the brothers before the city authorities, shouting, 'These men who have turned the world upside down have come here also... and they are all acting against the decrees of Caesar, saying that there is another king, Jesus.'"},
            {j:2, name:"Berea", lat:40.52, lng:22.20, year:50, title:"Noble Bereans", desc:"Search Scriptures daily", ref:"Acts 17:10-14", scripture:"The brothers immediately sent Paul and Silas away by night to Berea, and when they arrived they went into the Jewish synagogue. Now these Jews were more noble than those in Thessalonica; they received the word with all eagerness, examining the Scriptures daily to see if these things were so. Many of them therefore believed, with not a few Greek women of high standing as well as men."},
            {j:2, name:"Athens", lat:37.98, lng:23.73, year:51, title:"Mars Hill", desc:"Unknown God sermon at Areopagus", ref:"Acts 17:15-34", scripture:"Now while Paul was waiting for them at Athens, his spirit was provoked within him as he saw that the city was full of idols... So Paul, standing in the midst of the Areopagus, said: 'Men of Athens, I perceive that in every way you are very religious. For as I passed along and observed the objects of your worship, I found also an altar with this inscription: \"To the unknown god.\" What therefore you worship as unknown, this I proclaim to you... Being then God's offspring, we ought not to think that the divine being is like gold or silver or stone, an image formed by the art and imagination of man.'"},
            {j:2, name:"Corinth", lat:37.91, lng:22.88, year:51, title:"18 Months", desc:"Aquila & Priscilla, before Gallio", ref:"Acts 18:1-17", epistle:"1 & 2 Thessalonians (AD 51)", scripture:"After this Paul left Athens and went to Corinth. And he found a Jew named Aquila, a native of Pontus, recently come from Italy with his wife Priscilla... And he reasoned in the synagogue every Sabbath... And the Lord said to Paul one night in a vision, 'Do not be afraid, but go on speaking and do not be silent, for I am with you, and no one will attack you to harm you, for I have many in this city who are my people.' And he stayed a year and six months, teaching the word of God among them."},
            {j:2, name:"Cenchrea", lat:37.88, lng:23.0, year:52, title:"Vow", desc:"Paul cuts hair, vow taken", ref:"Acts 18:18", scripture:"After this, Paul stayed many days longer and then took leave of the brothers and set sail for Syria, and with him Priscilla and Aquila. At Cenchreae he had cut his hair, for he was under a vow."},
            {j:2, name:"Ephesus", lat:37.95, lng:27.37, year:52, title:"Brief Stop", desc:"Brief stop, promises return", ref:"Acts 18:19-21", scripture:"And they came to Ephesus, and he left them there, but he himself went into the synagogue and reasoned with the Jews. When they asked him to stay for a longer period, he declined. But on taking leave of them he said, 'I will return to you if God wills,' and he set sail from Ephesus."},
            {j:2, name:"Caesarea", lat:32.5, lng:34.88, year:52, title:"Landing", desc:"Lands in Judea", ref:"Acts 18:22", scripture:"When he had landed at Caesarea, he went up and greeted the church, and then went down to Antioch."},
            {j:2, name:"Jerusalem", lat:31.77, lng:35.21, year:52, title:"Greets Church", desc:"Goes up to greet church", ref:"Acts 18:22", scripture:"When he had landed at Caesarea, he went up and greeted the church, and then went down to Antioch."},
            {j:2, name:"Antioch", lat:36.2, lng:36.17, year:52, title:"Journey 2 Done", desc:"Second journey complete", ref:"Acts 18:22-23", scripture:"After spending some time there, he departed and went from one place to the next through the region of Galatia and Phrygia, strengthening all the disciples."},
            {j:3, name:"Galatia & Phrygia", lat:38.5, lng:31.0, year:53, title:"Strengthening", desc:"Strengthening disciples", ref:"Acts 18:23", scripture:"After spending some time there, he departed and went from one place to the next through the region of Galatia and Phrygia, strengthening all the disciples."},
            {j:3, name:"Ephesus", lat:37.95, lng:27.37, year:54, title:"3 Years", desc:"Longest stay: School of Tyrannus, miracles, Demetrius riot", ref:"Acts 19:1-41", epistle:"1 Corinthians (AD 55)", scripture:"And it happened that while Apollos was at Corinth, Paul passed through the inland country and came to Ephesus... And he entered the synagogue and for three months spoke boldly... he withdrew from them and took the disciples with him, reasoning daily in the hall of Tyrannus. This continued for two years... And God was doing extraordinary miracles by the hands of Paul, so that even handkerchiefs or aprons that had touched his skin were carried away to the sick... Then some of the itinerant Jewish exorcists undertook to invoke the name of the Lord Jesus... But the evil spirit answered them, 'Jesus I know, and Paul I recognize, but who are you?' And the man in whom was the evil spirit leaped on them... About that time there arose no little disturbance concerning the Way. For a man named Demetrius, a silversmith, who made silver shrines of Artemis... stirred up the craftsmen... And the city was filled with the confusion."},
            {j:3, name:"Macedonia", lat:40.5, lng:22.5, year:56, title:"Encouraging", desc:"Encouraging after riot", ref:"Acts 20:1-2", epistle:"2 Corinthians (AD 56)", scripture:"After the uproar ceased, Paul sent for the disciples, and after encouraging them, he said farewell and departed for Macedonia. When he had gone through those regions and had given them much encouragement, he came to Greece."},
            {j:3, name:"Greece", lat:38.0, lng:23.0, year:57, title:"3 Months", desc:"3 months, Jews plot", ref:"Acts 20:2-3", epistle:"Romans (AD 57)", scripture:"There he spent three months, and when a plot was made against him by the Jews as he was about to set sail for Syria, he decided to return through Macedonia."},
            {j:3, name:"Philippi", lat:41.01, lng:24.29, year:57, title:"After Passover", desc:"Sails after Unleavened Bread", ref:"Acts 20:4-6", scripture:"We sailed away from Philippi after the days of Unleavened Bread, and in five days we came to them at Troas, where we stayed for seven days."},
            {j:3, name:"Troas", lat:39.78, lng:26.06, year:57, title:"Eutychus", desc:"Eutychus falls, dies, Paul raises him", ref:"Acts 20:6-12", scripture:"On the first day of the week, when we were gathered together to break bread, Paul talked with them, intending to depart on the next day, and he prolonged his speech until midnight... And a young man named Eutychus, sitting at the window, sank into a deep sleep as Paul talked still longer. And being overcome by sleep, he fell down from the third story and was taken up dead. But Paul went down and bent over him, and taking him in his arms, said, 'Do not be alarmed, for his life is in him.' ...And they took the youth away alive, and were not a little comforted."},
            {j:3, name:"Assos", lat:39.51, lng:26.34, year:57, title:"Walking", desc:"Paul walks while others sail", ref:"Acts 20:13-14", scripture:"But going ahead to the ship, we set sail for Assos, intending to take Paul aboard there, for so he had arranged, intending himself to go by land."},
            {j:3, name:"Mitylene", lat:39.1, lng:26.56, year:57, title:"Sailing", desc:"Sailing stopover", ref:"Acts 20:14", scripture:"And when he met us at Assos, we took him on board and went to Mitylene."},
            {j:3, name:"Chios", lat:38.37, lng:26.14, year:57, title:"Sailing", desc:"Sailing stopover", ref:"Acts 20:15", scripture:"And sailing from there we came the following day opposite Chios."},
            {j:3, name:"Samos", lat:37.75, lng:26.98, year:57, title:"Sailing", desc:"Sailing stopover", ref:"Acts 20:15", scripture:"The next day we touched at Samos."},
            {j:3, name:"Miletus", lat:37.53, lng:27.28, year:57, title:"Farewell", desc:"Emotional farewell to Ephesian elders", ref:"Acts 20:15-38", scripture:"Now from Miletus he sent to Ephesus and called the elders of the church to come to him... 'You yourselves know how I lived among you the whole time from the first day that I set foot in Asia, serving the Lord with all humility... I did not shrink from declaring to you anything that was profitable... Therefore be alert, remembering that for three years I did not cease night or day to admonish every one with tears... And now I commend you to God and to the word of his grace... It is more blessed to give than to receive.' ...And there was much weeping on the part of all; they embraced Paul and kissed him, being sorrowful most of all because of the word he had spoken, that they would not see his face again."},
            {j:3, name:"Cos", lat:36.89, lng:27.29, year:57, title:"Sailing", desc:"Sailing stopover", ref:"Acts 21:1", scripture:"And when we had parted from them and set sail, we came by a straight course to Cos."},
            {j:3, name:"Rhodes", lat:36.43, lng:28.22, year:57, title:"Sailing", desc:"Sailing stopover", ref:"Acts 21:1", scripture:"And the next day to Rhodes."},
            {j:3, name:"Patara", lat:36.27, lng:29.32, year:57, title:"Ship Change", desc:"Find ship to Phoenicia", ref:"Acts 21:1-2", scripture:"And from there to Patara. And having found a ship crossing to Phoenicia, we went aboard and set sail."},
            {j:3, name:"Tyre", lat:33.27, lng:35.20, year:57, title:"Warning", desc:"Warned not to go to Jerusalem", ref:"Acts 21:3-6", scripture:"When we had come in sight of Cyprus, leaving it on the left we sailed to Syria and landed at Tyre, for there the ship was to unload its cargo. And having sought out the disciples, we stayed there for seven days. And through the Spirit they were telling Paul not to go on to Jerusalem."},
            {j:3, name:"Ptolemais", lat:32.93, lng:35.08, year:57, title:"One Day", desc:"One day with brethren", ref:"Acts 21:7", scripture:"When we had finished the voyage from Tyre, we arrived at Ptolemais, and we greeted the brothers and stayed with them for one day."},
            {j:3, name:"Caesarea", lat:32.5, lng:34.88, year:57, title:"Agabus", desc:"Agabus prophesies Paul's binding", ref:"Acts 21:8-14", scripture:"On the next day we departed and came to Caesarea, and we entered the house of Philip the evangelist... While we were staying for many days, a prophet named Agabus came down from Judea. And coming to us, he took Paul's belt and bound his own feet and hands and said, 'Thus says the Holy Spirit, \"This is how the Jews at Jerusalem will bind the man who owns this belt and deliver him into the hands of the Gentiles.\"' When we heard this, we and the people there urged him not to go up to Jerusalem. Then Paul answered, 'What are you doing, weeping and breaking my heart? For I am ready not only to be imprisoned but even to die in Jerusalem for the name of the Lord Jesus.'"},
            {j:3, name:"Jerusalem", lat:31.77, lng:35.21, year:58, title:"Arrested", desc:"Arrested in temple, bound in chains", ref:"Acts 21:15-40", scripture:"After these days we got ready and went up to Jerusalem... When the seven days were almost completed, the Jews from Asia, seeing him in the temple, stirred up the whole crowd and laid hands on him, crying out, 'Men of Israel, help! This is the man who is teaching everyone everywhere against the people and the law and this place'... Then all the city was stirred up, and the people ran together. They seized Paul and dragged him out of the temple... And as they were seeking to kill him, word came to the tribune of the cohort that all Jerusalem was in confusion. He at once took soldiers and centurions and ran down to them. And when they saw the tribune and the soldiers, they stopped beating Paul. Then the tribune came up and arrested him and ordered him to be bound with two chains."}
        ];
        
        const scriptures = [
            "Barnabas and Saul sent out by the Holy Spirit from Antioch. They preach in Cyprus, where Paul strikes Elymas the sorcerer blind. Proconsul Sergius Paulus believes. In Antioch of Pisidia, Paul preaches his first recorded sermon, tracing Israel history to Jesus. Initially accepted, then Jews stir persecution. Paul declares: 'We turn to the Gentiles.'",
            "In Iconium, great multitude believes but opposition rises. In Lystra, Paul heals a crippled man but is later stoned and left for dead - he rises and continues. Many disciples made in Derbe. They return through the same cities, strengthening disciples and appointing elders. Return to Antioch reporting all God has done.",
            "Jerusalem Council convenes over circumcision question. Peter, Paul, and James speak. Decision: Gentiles do not need circumcision, only abstain from certain things. Letter sent to churches. Paul and Barnabas split over John Mark - Barnabas takes Mark to Cyprus, Paul takes Silas for second journey.",
            "Timothy joins at Lystra. Forbidden to preach in Asia, led to Macedonia by vision. At Philippi: Lydia believes, demon cast from slave girl, Paul and Silas beaten and imprisoned. Earthquake opens prison doors. Philippian jailer saved. Released as Roman citizens.",
            "In Thessalonica, mob attacks Jason's house. Bereans nobly search Scriptures daily. At Athens, Paul delivers famous Mars Hill sermon about the 'Unknown God.' Dionysius and Damaris believe.",
            "Paul in Corinth 18 months. Meets Aquila and Priscilla. Crispus believes. Vision: 'I have many people in this city.' Before Gallio who dismisses charges. Writes 1 & 2 Thessalonians. Brief stop at Ephesus. Returns to Jerusalem then Antioch.",
            "Paul's longest ministry - 3 years in Ephesus. Disciples baptized in Holy Spirit. 3 months in synagogue, 2 years in School of Tyrannus. Extraordinary miracles through handkerchiefs. Sons of Sceva incident. Magic books burned (50,000 pieces of silver). Riot by Demetrius over Diana temple. Writes 1 Corinthians.",
            "Paul travels through Macedonia encouraging believers (writes 2 Corinthians there). 3 months in Greece (writes Romans from Corinth). Jews plot, so returns through Macedonia. At Troas, Eutychus falls from window and dies - Paul raises him. Emotional farewell at Miletus with Ephesian elders: 'You will see my face no more.'",
            "Disciples at Tyre warn Paul through Spirit not to go to Jerusalem. At Caesarea, prophet Agabus binds himself with Paul's belt, prophesying Paul will be bound. All plead with Paul not to go. Paul: 'I am ready not only to be bound, but to die at Jerusalem.' In Jerusalem, takes vow with 4 men. Jews from Asia stir mob, drag him from temple. Roman commander rescues, binds him in chains."
        ];
        
        const quizData = [
            {q:"On which island did Paul strike Elymas blind?", a:["Cyprus","Malta","Crete","Sicily"], c:0, e:"Acts 13:6-12 at Paphos, Cyprus"},
            {q:"Who was Paul's first companion before they split?", a:["Barnabas","Silas","Timothy","Luke"], c:0, e:"Acts 13-14, split in Acts 15:36-41"},
            {q:"Where was Paul stoned and left for dead?", a:["Lystra","Iconium","Derbe","Antioch"], c:0, e:"Acts 14:19-20 after healing crippled man"},
            {q:"What did the Jerusalem Council decide?", a:["Gentiles don't need circumcision","All must be circumcised","Gentiles can't be saved","Jews must follow Gentile law"], c:0, e:"Acts 15 - Gentiles freed from circumcision"},
            {q:"Who joined Paul at Lystra on journey 2?", a:["Timothy","Silas","Luke","Titus"], c:0, e:"Acts 16:1-3 - Timothy joined the team"},
            {q:"What vision did Paul see at Troas?", a:["Macedonian saying 'Come help us'","Angel with scroll","Great light","Jesus commanding"], c:0, e:"Acts 16:9-10 - redirected to Europe"},
            {q:"Where were Paul and Silas freed by earthquake?", a:["Philippi","Thessalonica","Corinth","Ephesus"], c:0, e:"Acts 16:25-26 - jailer saved"},
            {q:"Who searched Scriptures daily?", a:["Bereans","Thessalonians","Athenians","Corinthians"], c:0, e:"Acts 17:11 - noble Bereans"},
            {q:"Where did Paul preach about 'Unknown God'?", a:["Athens at Mars Hill","Corinth","Ephesus","Jerusalem"], c:0, e:"Acts 17:22-31 - Areopagus sermon"},
            {q:"How long did Paul stay in Corinth?", a:["18 months","3 years","6 months","2 years"], c:0, e:"Acts 18:11"},
            {q:"How long did Paul minister in Ephesus?", a:["3 years","18 months","1 year","5 years"], c:0, e:"Acts 20:31 - longest stay"},
            {q:"What miracles occurred in Ephesus?", a:["Healing through handkerchiefs","Raising dead","Walking on water","Multiplying food"], c:0, e:"Acts 19:11-12 - extraordinary miracles"},
            {q:"Who tried to cast out demons and failed?", a:["Sons of Sceva","Simon the Sorcerer","Bar-Jesus","Alexander"], c:0, e:"Acts 19:13-16 - demon overpowered them"},
            {q:"Value of magic books burned in Ephesus?", a:["50,000 pieces of silver","10,000","100,000","30"], c:0, e:"Acts 19:19 - massive book burning"},
            {q:"Who started the silversmith riot?", a:["Demetrius","Alexander","Gaius","Aristarchus"], c:0, e:"Acts 19:24-29 - Diana/Artemis shrine maker"},
            {q:"Where did Paul raise Eutychus?", a:["Troas","Miletus","Ephesus","Philippi"], c:0, e:"Acts 20:9-12 - fell from window"},
            {q:"Which epistle is about salvation?", a:["Romans","Ephesians","Galatians","Hebrews"], c:0, e:"Written from Corinth AD 57"},
            {q:"Who prophesied Paul would be bound?", a:["Agabus","Philip's daughters","Ananias","Silas"], c:0, e:"Acts 21:10-11 - belt demonstration"},
            {q:"Which letters were written from Corinth?", a:["1&2 Thessalonians, Romans","Galatians, Ephesians","Philippians, Colossians","1&2 Timothy"], c:0, e:"1&2 Thess AD 51, Romans AD 57"},
            {q:"Where was Paul when arrested?", a:["Jerusalem temple","Ephesus theater","Philippi prison","Athens marketplace"], c:0, e:"Acts 21:15-40 - dragged from temple"}
        ];
        
        // MAP & STEP NAVIGATION
        let map, markers = [], paths = [], currentFilter = 'all', currentStep = 0, stepMode = false, currentJourneyData = [];
        const colors = {1: '#3498db', 2: '#e74c3c', 3: '#2ecc71'};
        
        // Helper function to create consistent popup HTML
        function createPopupHTML(loc, stepNum) {
            return `
                <div style="min-width:250px;max-width:350px;">
                    <h3 style="color:${colors[loc.j]};margin:0 0 8px 0;">
                        <span style="background:${colors[loc.j]};color:white;padding:2px 8px;border-radius:12px;font-size:0.8em;margin-right:6px;">Step ${stepNum}</span>
                        ${loc.name}
                    </h3>
                    <p style="margin:4px 0;"><strong>${loc.title}</strong></p>
                    <p style="margin:4px 0;font-size:13px;">${loc.desc}</p>
                    <p style="margin:8px 0;padding:8px;background:#f0f4ff;border-left:3px solid ${colors[loc.j]};border-radius:4px;">
                        <strong style="color:${colors[loc.j]};">${loc.ref}</strong>
                    </p>
                    <div style="max-height:150px;overflow-y:auto;padding:10px;background:#f8f9fa;border-radius:4px;margin:8px 0;font-size:12px;line-height:1.6;color:#2c3e50;">
                        ${loc.scripture || 'Scripture text not available'}
                    </div>
                    <p style="margin:4px 0;color:#666;font-size:12px;"><em>AD ${loc.year}</em></p>
                    ${loc.epistle ? `<p style="margin:8px 0 0;padding:8px;background:#f8f9fa;border-left:3px solid #9b59b6;border-radius:4px;"><strong>üìú ${loc.epistle}</strong></p>` : ''}
                </div>
            `;
        }
        
        function initMap() {
            map = L.map('map').setView([37, 28], 5);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles ¬© Esri',
                maxZoom: 18
            }).addTo(map);
            drawAll();
            console.log("Map initialized");
        }
        
        function clearMap() {
            markers.forEach(m => map.removeLayer(m));
            paths.forEach(p => map.removeLayer(p));
            markers = [];
            paths = [];
        }
        
        function drawAll() {
            clearMap();
            const data = currentFilter === 'all' ? journeyData : journeyData.filter(d => d.j === currentFilter);
            
            data.forEach((loc, i) => {
                const color = loc.epistle ? '#9b59b6' : colors[loc.j];
                const size = loc.epistle ? 20 : 16;
                
                // Calculate step number within this journey
                const journeySteps = journeyData.filter(d => d.j === loc.j);
                const stepNum = journeySteps.findIndex(s => s.name === loc.name && s.year === loc.year) + 1;
                
                const icon = L.divIcon({
                    html: `<div style="background:${color};width:${size}px;height:${size}px;border-radius:50%;border:2px solid white;box-shadow:0 2px 4px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:${size > 16 ? '10px' : '9px'};">${stepNum}</div>`,
                    iconSize: [size, size],
                    className: ''
                });
                
                const m = L.marker([loc.lat, loc.lng], {icon}).addTo(map);
                m.bindPopup(createPopupHTML(loc, stepNum), {maxWidth: 400});
                markers.push(m);
                
                if (i < data.length - 1 && data[i+1].j === loc.j) {
                    const p = L.polyline([[loc.lat, loc.lng], [data[i+1].lat, data[i+1].lng]], 
                        {color: colors[loc.j], weight: 2, opacity: 0.6}).addTo(map);
                    paths.push(p);
                }
            });
            
            if (markers.length > 0) {
                const group = L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }
        
        function showJourney(j) {
            currentFilter = j;
            stepMode = false;
            currentStep = 0;
            
            document.querySelectorAll('.section .btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            drawAll();
            
            document.getElementById('stat-locations').textContent = currentFilter === 'all' ? journeyData.length : journeyData.filter(d => d.j === currentFilter).length;
            
            // Enable step navigation if specific journey selected
            if (j !== 'all') {
                // Convert j to number if it's a string
                const journeyNum = typeof j === 'string' ? parseInt(j) : j;
                currentJourneyData = journeyData.filter(d => d.j === journeyNum);
                console.log('Journey selected:', journeyNum, 'Locations:', currentJourneyData.length);
                document.getElementById('step-info').textContent = `Ready to walk through Journey ${journeyNum} step-by-step (${currentJourneyData.length} locations)`;
                document.getElementById('prev-btn').disabled = false;
                document.getElementById('next-btn').disabled = false;
                document.getElementById('reset-btn').style.display = 'block';
            } else {
                currentJourneyData = [];
                document.getElementById('step-info').textContent = 'Select a journey to navigate step-by-step';
                document.getElementById('prev-btn').disabled = true;
                document.getElementById('next-btn').disabled = true;
                document.getElementById('reset-btn').style.display = 'none';
            }
        }
        
        // Make globally accessible
        window.showJourney = showJourney;
        
        function prevStep() {
            console.log('prevStep called, currentStep:', currentStep, 'dataLength:', currentJourneyData.length);
            if (!currentJourneyData.length || currentStep === 0) return;
            currentStep--;
            showCurrentStep();
        }
        
        function nextStep() {
            console.log('nextStep called, currentStep:', currentStep, 'dataLength:', currentJourneyData.length);
            if (!currentJourneyData.length) return;
            
            // If we're at step 0 and not in step mode yet, show step 0 (first location)
            if (currentStep === 0 && !stepMode) {
                showCurrentStep();
                return;
            }
            
            // Otherwise increment normally
            if (currentStep >= currentJourneyData.length - 1) return;
            currentStep++;
            showCurrentStep();
        }
        
        function resetSteps() {
            console.log('resetSteps called');
            currentStep = 0;
            stepMode = false;
            showJourney(currentFilter);
        }
        
        // Make functions globally accessible
        window.prevStep = prevStep;
        window.nextStep = nextStep;
        window.resetSteps = resetSteps;
        
        function showCurrentStep() {
            stepMode = true;
            clearMap();
            
            // Show all steps up to current
            for (let i = 0; i <= currentStep; i++) {
                const loc = currentJourneyData[i];
                const color = loc.epistle ? '#9b59b6' : colors[loc.j];
                const size = (i === currentStep) ? 24 : (loc.epistle ? 18 : 16); // Current step is larger
                const stepNum = i + 1;
                
                const icon = L.divIcon({
                    html: `<div style="background:${color};width:${size}px;height:${size}px;border-radius:50%;border:2px solid ${i === currentStep ? 'yellow' : 'white'};box-shadow:0 2px ${i === currentStep ? '8px' : '4px'} rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:${size > 20 ? '12px' : '10px'};">${stepNum}</div>`,
                    iconSize: [size, size],
                    className: ''
                });
                
                const m = L.marker([loc.lat, loc.lng], {icon}).addTo(map);
                m.bindPopup(createPopupHTML(loc, stepNum), {maxWidth: 400});
                markers.push(m);
                
                // Draw path to next location
                if (i < currentStep) {
                    const nextLoc = currentJourneyData[i+1];
                    const p = L.polyline([[loc.lat, loc.lng], [nextLoc.lat, nextLoc.lng]], 
                        {color: colors[loc.j], weight: 3, opacity: 0.8}).addTo(map);
                    paths.push(p);
                }
            }
            
            // Center on current step
            const currentLoc = currentJourneyData[currentStep];
            map.setView([currentLoc.lat, currentLoc.lng], 7);
            
            // Open popup for current location
            if (markers[currentStep]) {
                markers[currentStep].openPopup();
            }
            
            // Update step info
            document.getElementById('step-info').innerHTML = `
                <strong>Step ${currentStep + 1} of ${currentJourneyData.length}</strong><br>
                ${currentLoc.name} - ${currentLoc.title}
            `;
            
            // Update button states
            document.getElementById('prev-btn').disabled = (currentStep === 0);
            document.getElementById('next-btn').disabled = (currentStep >= currentJourneyData.length - 1);
        }
        
        // TABS
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.closest('.tab-btn').classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');
        }
        
        // SCRIPTURE
        function showScripture(idx) {
            const container = document.getElementById('scripture-texts');
            const buttons = document.querySelectorAll('.scripture-btn');
            
            buttons.forEach((b, i) => {
                b.classList.toggle('active', i === idx);
            });
            
            container.innerHTML = `<div class="scripture-text active">${scriptures[idx]}</div>`;
        }
        
        // QUIZ
        let currentQ = 0, score = 0;
        const letters = ['A', 'B', 'C', 'D'];
        
        function startQuiz() {
            currentQ = 0;
            score = 0;
            document.querySelector('.quiz-intro').style.display = 'none';
            document.querySelector('.quiz-question').style.display = 'block';
            showQuestion();
        }
        
        function showQuestion() {
            if (currentQ >= quizData.length) {
                endQuiz();
                return;
            }
            
            const q = quizData[currentQ];
            document.getElementById('q-num').textContent = currentQ + 1;
            document.getElementById('q-text').textContent = q.q;
            
            const container = document.getElementById('q-answers');
            container.innerHTML = '';
            q.a.forEach((ans, i) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-answer';
                btn.setAttribute('data-letter', letters[i]);
                btn.textContent = ans;
                btn.onclick = () => checkAnswer(i);
                container.appendChild(btn);
            });
            
            document.getElementById('q-feedback').classList.remove('active');
            document.getElementById('next-btn-quiz').style.display = 'none';
        }
        
        function checkAnswer(selected) {
            const q = quizData[currentQ];
            const correct = selected === q.c;
            if (correct) score++;
            
            const buttons = document.querySelectorAll('.quiz-answer');
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === q.c) btn.classList.add('correct');
                else if (i === selected && !correct) btn.classList.add('incorrect');
            });
            
            const feedback = document.getElementById('q-feedback');
            feedback.innerHTML = `
                <div class="feedback-status" style="color:${correct?'#27ae60':'#e74c3c'};">
                    ${correct ? '‚úì Correct!' : '‚úó Incorrect'}
                </div>
                <div>${q.e}</div>
            `;
            feedback.classList.add('active');
            document.getElementById('next-btn-quiz').style.display = 'block';
        }
        
        function nextQuestion() {
            currentQ++;
            showQuestion();
        }
        
        function endQuiz() {
            const pct = Math.round(score / quizData.length * 100);
            document.querySelector('.quiz-question').style.display = 'none';
            document.querySelector('.quiz-intro').style.display = 'block';
            document.querySelector('.quiz-intro').innerHTML = `
                <h3>üéâ Quiz Complete!</h3>
                <p style="font-size:36px;margin:20px 0;font-weight:bold;">${score} / ${quizData.length}</p>
                <p style="font-size:24px;margin:15px 0;">${pct}% Correct</p>
                <p style="margin:15px 0;font-size:1.1em;">${pct >= 90 ? 'üèÜ Outstanding! You truly know Paul\'s journeys!' : pct >= 70 ? 'üëç Great job! Solid understanding!' : pct >= 50 ? 'üìñ Good effort! Review to improve.' : 'üìö Keep studying the journeys!'}</p>
                <button class="btn" onclick="location.reload()" style="margin-top:15px;">
                    <span class="btn-icon">üîÑ</span>
                    <span>Retake Quiz</span>
                </button>
            `;
        }
        
        // INITIALIZE
        window.onload = function() {
            initMap();
            console.log("‚úÖ All systems loaded!");
        };
    </script>
</body>
</html>
